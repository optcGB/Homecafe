<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë°© ì£¼ë¬¸ í˜„í™©íŒ (Admin)</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; margin: 0; padding: 0; background-color: #222; color: white; }
        .header { background-color: #333; padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ffaa00; }
        .title { font-size: 24px; font-weight: bold; }
        .status { font-size: 14px; color: #aaa; }
        .order-container { padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        
        .order-ticket { background-color: #fff; color: #333; border-radius: 10px; overflow: hidden; animation: slideIn 0.3s ease; border: 2px solid white; }
        .ticket-header { background-color: #ffaa00; padding: 10px 15px; font-weight: bold; display: flex; justify-content: space-between; }
        .ticket-body { padding: 15px; min-height: 100px; }
        .menu-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1.2em; border-bottom: 1px dashed #ddd; padding-bottom: 5px; font-weight: bold; }
        .ticket-footer { padding: 10px; text-align: center; background-color: #eee; }
        .btn-done { background-color: #222; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-size: 1.1em; width: 100%; font-weight: bold; }
        .btn-done:hover { background-color: #000; }
        .empty-msg { grid-column: 1 / -1; text-align: center; margin-top: 100px; color: #555; font-size: 1.5em; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">ğŸ”¥ ì£¼ë°© ì£¼ë¬¸ í˜„í™©íŒ</div>
        <div class="status">í™”ë©´ì„ í•œë²ˆ í´ë¦­í•´ì£¼ì„¸ìš” <span id="clock">00:00:00</span></div>
    </div>

    <div class="order-container" id="order-board">
        <div class="empty-msg">ëŒ€ê¸° ì¤‘ì¸ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>

    <script>
        // ì‚¬ì¥ë‹˜ì˜ Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyBt4Lu0sLApn-83QMpnfLkjzxBchqcwRzQ",
            authDomain: "homecafe-15677.firebaseapp.com",
            databaseURL: "https://homecafe-15677-default-rtdb.firebaseio.com",
            projectId: "homecafe-15677",
            storageBucket: "homecafe-15677.firebasestorage.app",
            messagingSenderId: "884719230706",
            appId: "1:884719230706:web:2f991c46fbdc8640ee7a6b",
            measurementId: "G-M4W6D9S560"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // ì‹œê³„
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);

        // ğŸ”¥ ì„œë²„ì—ì„œ ì£¼ë¬¸ ì‹¤ì‹œê°„ ê°ì‹œ (ìƒˆ ì£¼ë¬¸ì´ ì˜¤ë©´ ì¦‰ì‹œ í™”ë©´ì— ëœ¸)
        const orderBoard = document.getElementById('order-board');
        const ordersRef = db.ref('orders');

        // 1. ìƒˆ ì£¼ë¬¸ì´ ì¶”ê°€ë  ë•Œ
        ordersRef.on('child_added', (snapshot) => {
            const order = snapshot.val();
            const key = snapshot.key; // ì£¼ë¬¸ì˜ ê³ ìœ  ID

            // ë¹ˆ ë©”ì‹œì§€ ì‚­ì œ
            const emptyMsg = document.querySelector('.empty-msg');
            if (emptyMsg) emptyMsg.remove();

            createTicket(key, order);
            
            // âœ¨ [ì¶”ê°€ëœ ê¸°ëŠ¥] ì£¼ë¬¸ì´ ë“¤ì–´ì˜¤ë©´ ì†Œë¦¬ ì¬ìƒ
            playSound();
        });

        // 2. ì£¼ë¬¸ì´ ì‚­ì œë  ë•Œ (ì™„ë£Œ ì²˜ë¦¬ ì‹œ)
        ordersRef.on('child_removed', (snapshot) => {
            const key = snapshot.key;
            const ticket = document.getElementById(key);
            if (ticket) ticket.remove();
            
            // ë‹¤ ì§€ì›Œì§€ë©´ ë¹ˆ ë©”ì‹œì§€ í‘œì‹œ
            if (orderBoard.children.length === 0) {
                orderBoard.innerHTML = '<div class="empty-msg">ëŒ€ê¸° ì¤‘ì¸ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        });

        function createTicket(key, order) {
            let menuHtml = '';
            order.items.forEach(item => {
                menuHtml += `
                    <div class="menu-row">
                        <span>${item.name}</span>
                        <span>${item.count}</span>
                    </div>
                `;
            });

            const ticket = document.createElement('div');
            ticket.className = 'order-ticket';
            ticket.id = key; // ë‚˜ì¤‘ì— ì‚­ì œí•˜ê¸° ìœ„í•´ ID ë¶€ì—¬
            ticket.innerHTML = `
                <div class="ticket-header">
                    <span>ì£¼ë¬¸ì ‘ìˆ˜</span>
                    <span class="ticket-time">${order.time}</span>
                </div>
                <div class="ticket-body">
                    ${menuHtml}
                </div>
                <div class="ticket-footer">
                    <button class="btn-done" onclick="completeOrder('${key}')">ì¡°ë¦¬ ì™„ë£Œ</button>
                </div>
            `;
            orderBoard.appendChild(ticket);
        }

        // ì¡°ë¦¬ ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì‹œ -> ì„œë²„ì—ì„œ ë°ì´í„° ì‚­ì œ
        function completeOrder(key) {
            db.ref('orders').child(key).remove()
                .catch(error => alert("ì˜¤ë¥˜: " + error.message));
        }

        // âœ¨ [ì¶”ê°€ëœ ê¸°ëŠ¥] ì•Œë¦¼ ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
        function playSound() {
            // 'ë”©ë™' ì†Œë¦¬ íŒŒì¼ (ë¬´ë£Œ íš¨ê³¼ìŒ URL)
            const audio = new Audio('https://t1.daumcdn.net/cfile/tistory/99412B355CF6B93806');
            
            // ë¸Œë¼ìš°ì € ì •ì±…ìƒ ì‚¬ìš©ìê°€ í™”ë©´ì„ í´ë¦­í•˜ì§€ ì•Šìœ¼ë©´ ì†Œë¦¬ê°€ ì°¨ë‹¨ë  ìˆ˜ ìˆìŒ
            audio.play().catch(e => {
                console.log("ìë™ ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. í™”ë©´ì„ í´ë¦­í•´ì£¼ì„¸ìš”.");
            });
        }
    </script>
</body>
</html>
